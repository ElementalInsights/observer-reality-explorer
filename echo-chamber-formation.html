<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo Chamber Formation - Network Polarization</title>
    <script src="physics-engine.js"></script>
    <script src="chart-renderer.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            background: #000;
            color: #fff;
            overflow: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 400px 1fr;
            grid-template-rows: auto 1fr;
            gap: 20px;
            height: 100vh;
            padding: 20px;
        }

        .header {
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #444;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            color: #fff;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .header-left p {
            color: #888;
            font-size: 0.9em;
        }

        .header-right {
            display: flex;
            gap: 10px;
        }

        .header-right button {
            padding: 10px 20px;
            background: #444;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.95em;
            transition: background 0.3s;
        }

        .header-right button:hover {
            background: #555;
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border: 2px solid #444;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }

        .panel h2 {
            color: #fff;
            font-size: 1.3em;
            margin-bottom: 15px;
            letter-spacing: 0.5px;
        }

        .canvas-wrapper {
            background: #0a0e27;
            border: 2px solid #555;
            border-radius: 8px;
            overflow: hidden;
            height: 100%;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .control-section {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid #555;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .control-section h3 {
            color: #fff;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .slider-control {
            margin-bottom: 20px;
        }

        .slider-control label {
            display: block;
            color: #ccc;
            font-size: 0.9em;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .value-display {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 8px;
            border-radius: 3px;
            color: #fff;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            padding: 10px 0;
            background: transparent;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid #555;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #fff;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #ccc;
            font-size: 0.85em;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .info-box code {
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 3px;
            color: #ddd;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #bbb;
            font-size: 0.9em;
        }

        .stat-value {
            color: #fff;
            font-weight: bold;
            font-size: 1em;
        }

        .back-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: #444;
            border: 2px solid #666;
            border-radius: 8px;
            color: #fff;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            text-decoration: none;
            font-weight: bold;
            font-size: 1em;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        .back-btn:hover {
            background: #555;
            transform: translateX(-5px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>üåê Echo Chamber Formation</h1>
                <p>Watch polarization emerge from homophily: "Birds of a feather flock together"</p>
            </div>

            <div class="header-right">
                <button id="playBtn" onclick="togglePlay()">‚è∏Ô∏è Pause</button>
                <button onclick="resetNetwork()">üîÑ Reset</button>
            </div>
        </div>

        <!-- Left Panel: Controls -->
        <div class="panel">
            <div class="control-section">
                <h3>üéõÔ∏è Network Evolution Rules</h3>

                <div class="slider-control">
                    <label>Homophily (Like-attracts-like): <span class="value-display" id="homophilyValue">0.00</span></label>
                    <input type="range" id="homophilySlider" min="0" max="100" value="0" step="1"
                           oninput="updateHomophily(this.value)">
                </div>

                <div class="slider-control">
                    <label>Clustering (Group cohesion): <span class="value-display" id="clusteringValue">0.00</span></label>
                    <input type="range" id="clusteringSlider" min="0" max="100" value="0" step="1"
                           oninput="updateClustering(this.value)">
                </div>

                <div class="slider-control">
                    <label>Rewiring (Random changes): <span class="value-display" id="rewiringValue">0.00</span></label>
                    <input type="range" id="rewiringSlider" min="0" max="100" value="0" step="1"
                           oninput="updateRewiring(this.value)">
                </div>
            </div>

            <div class="info-box">
                <h3>üìä Network Metrics</h3>
                <div class="stat-row">
                    <span class="stat-label">Clusters:</span>
                    <span class="stat-value">5 groups</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Connections:</span>
                    <span class="stat-value" id="connectionCount">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Network Density:</span>
                    <span class="stat-value" id="networkDensity">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Spatial Spread:</span>
                    <span class="stat-value" id="spatialSpread">--</span>
                </div>
            </div>

            <div class="info-box">
                <h3>üß† How It Works</h3>
                <p><strong>Homophily:</strong> Particles in the same cluster (color) attract each other. "Birds of a feather..."</p>
                <p><strong>Clustering:</strong> Each group pulls toward its centroid. Forms tight echo chambers.</p>
                <p><strong>Rewiring:</strong> Random particles switch groups. Introduces noise/exploration.</p>
                <p><code>Increase homophily ‚Üí Watch echo chambers form!</code></p>
            </div>

            <div class="info-box">
                <h3>üî¨ Try This</h3>
                <p>1. Set Homophily to <strong>50-80%</strong></p>
                <p>2. Watch clusters separate</p>
                <p>3. Add Clustering <strong>30-50%</strong></p>
                <p>4. See tight echo chambers form</p>
                <p>5. Add Rewiring <strong>5-10%</strong> to prevent total isolation</p>
            </div>
        </div>

        <!-- Right Panel: Canvas -->
        <div class="canvas-wrapper">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <!-- Back Button -->
    <a href="index.html" class="back-btn">‚Üê Back</a>

    <script>
        // Initialize engine in SOCIAL mode (clusters)
        const engine = new ObserverPhysicsEngine('canvas', {
            observerType: 'social',
            populationSize: 100,
            enableTimeSeries: true
        });

        engine.isPlaying = true;
        engine.start();

        // Apply network evolution every frame
        const originalUpdate = engine.updatePhysics.bind(engine);
        engine.updatePhysics = function() {
            originalUpdate();
            engine.evolveNetwork(); // Apply network rules
        };

        // Control functions
        function updateHomophily(value) {
            const normalized = value / 100;
            engine.setNetworkRule('homophily', normalized);
            document.getElementById('homophilyValue').textContent = normalized.toFixed(2);
        }

        function updateClustering(value) {
            const normalized = value / 100;
            engine.setNetworkRule('clustering', normalized);
            document.getElementById('clusteringValue').textContent = normalized.toFixed(2);
        }

        function updateRewiring(value) {
            const normalized = value / 100;
            engine.setNetworkRule('rewiring', normalized);
            document.getElementById('rewiringValue').textContent = normalized.toFixed(2);
        }

        function togglePlay() {
            engine.isPlaying = !engine.isPlaying;
            const btn = document.getElementById('playBtn');
            btn.textContent = engine.isPlaying ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
        }

        function resetNetwork() {
            // Reset network rules
            engine.setNetworkRule('homophily', 0);
            engine.setNetworkRule('clustering', 0);
            engine.setNetworkRule('rewiring', 0);

            // Reset sliders
            document.getElementById('homophilySlider').value = 0;
            document.getElementById('clusteringSlider').value = 0;
            document.getElementById('rewiringSlider').value = 0;
            document.getElementById('homophilyValue').textContent = '0.00';
            document.getElementById('clusteringValue').textContent = '0.00';
            document.getElementById('rewiringValue').textContent = '0.00';

            // Recreate particles (uniform distribution)
            engine.createParticles();
        }

        // Update metrics
        setInterval(() => {
            const telemetry = engine.getTelemetry();
            document.getElementById('connectionCount').textContent = telemetry.connectionCount || 0;
            document.getElementById('networkDensity').textContent = (telemetry.networkDensity || 0).toFixed(3);
            document.getElementById('spatialSpread').textContent = (telemetry.spatialSpread || 0).toFixed(1) + ' px';
        }, 100);
    </script>
</body>
</html>
